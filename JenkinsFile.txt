pipeline {
    agent any
    stages {
    	stage('Initialize'){
            steps {
                sh 'chmod -R 777 ${WORKSPACE}'
            }
        }
	stage('Copy Packages from Git'){
		steps{
		sh '${WORKSPACE}/CopyPackageToVM.sh'
	    }
	}
	
	stage('Create base docker file'){
            steps {
                sh "${MSR_TARGET_DOCKER}/is_container.sh createDockerfile "
            }
        }
	stage('Build base MSR image'){
            steps {
                sh "${MSR_TARGET_DOCKER}/is_container.sh build -Dimage.name=is:msr"
            }
        }
	stage('Create package docker files'){
            steps {
                sh "${MSR_TARGET_DOCKER}/is_container.sh createPackageDockerfile -Dimage.name=is:msr -Dpackage.list=Customers -Dfile.name=CustomerMSR"
		echo "Customers package docker file created"
		sh "${MSR_TARGET_DOCKER}/is_container.sh createPackageDockerfile -Dimage.name=is:msr -Dpackage.list=Employee -Dfile.name=EmployeeMSR"
		echo "Employee package docker file created"

            }
        }
	stage('Build MSR image with packages'){
            steps {
                sh "${MSR_TARGET_DOCKER}/is_container.sh buildPackage -Dimage.name=is:${CustomerTag} -Dfile.name=CustomerMSR"
		echo "Customers MSR image built successfully"
		 sh "${MSR_TARGET_DOCKER}/is_container.sh buildPackage -Dimage.name=is:${EmployeeTag} -Dfile.name=EmployeeMSR"
		echo "Employee MSR image built successfully"

            }
        }
     }
    }
